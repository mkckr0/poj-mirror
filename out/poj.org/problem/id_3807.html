<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>3807 -- Chemist’s Math</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D3807"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=3807&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">Chemist’s Math</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 1000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 115</td><td width="10px"></td><td><b>Accepted:</b> 36</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">You have probably learnt chemical equations (chemical reaction formulae) in your high-school days. The following are some well-known equations.<br/><center> <br/>2H<sub>2</sub> + O<sub>2</sub> -&gt; 2H<sub>2</sub>O (1)<br/>Ca(OH)<sub>2</sub> + CO<sub>2</sub> -&gt; CaCO<sub>3</sub> + H<sub>2</sub>O (2)<br/>N<sub>2</sub> + 3H<sub>2</sub> -&gt; 2NH<sub>3</sub> (3)<br/></center> <br/>While Equations (1)–(3) all have balanced left-hand sides and right-hand sides, the following ones do not.<br/><center> <br/>Al + O<sub>2</sub> -&gt; Al<sub>2</sub>O<sub>3</sub> (wrong) (4)<br/>C<sub>3</sub>H<sub>8</sub> + O<sub>2</sub> -&gt; CO<sub>2</sub> + H<sub>2</sub>O (wrong) (5)<br/></center> <br/>The equations must follow the law of conservation of mass; the quantity of each chemical element (such as H, O, Ca, Al) should not change with chemical reactions. So we should “adjust” the numbers of molecules on the left-hand side and right-hand side:<br/><center> <br/>4Al + 3O<sub>2</sub> -&gt; 2Al<sub>2</sub>O<sub>3</sub> (correct) (6)<br/>C<sub>3</sub>H<sub>8</sub> + 5O<sub>2</sub> -&gt; 3CO<sub>2</sub> + 4H<sub>2</sub>O (correct) (7)<br/></center> <br/>The coeﬃcients of Equation (6) are (4, 3, 2) from left to right, and those of Equation (7) are (1, 5, 3, 4) from left to right. Note that the coeﬃcient 1 may be omitted from chemical equations.<br/> <br/>The coeﬃcients of a correct equation must satisfy the following conditions.<br/> <br/>1. The coeﬃcients are all positive integers.<br/>2. The coeﬃcients are relatively prime, that is, their greatest common divisor (g.c.d.) is 1.<br/>3. The quantities of each chemical element on the left-hand side and the right-hand side are equal.<br/> <br/>Conversely, if a chemical equation satisﬁes the above three conditions, we regard it as a correct equation, no matter whether the reaction or its constituent molecules can be chemically realized in the real world, and no matter whether it can be called a reaction (e.g., H<sub>2</sub> -&gt; H<sub>2</sub> is considered correct). A chemical equation satisfying Conditions 1 and 3 (but not necessarily Condition 2) is called a balanced equation.<br/> <br/>Your goal is to read in chemical equations with missing coeﬃcients like Equation (4) and (5), line by line, and output the sequences of coeﬃcients that make the equations correct. Note that the above three conditions do not guarantee that a correct equation is uniquely determined. For example, if we “mix” the reactions generating H<sub>2</sub>O and NH<sub>3</sub>, we would get<br/><center> <br/>xH<sub>2</sub> + yO<sub>2</sub> + zN<sub>2</sub> + uH<sub>2</sub> -&gt; vH<sub>2</sub>O + wNH<sub>3</sub> (8)<br/></center> <br/>but (x, y, z, u, v, w) = (2, 1, 1, 3, 2, 2) does not represent a unique correct equation; for instance, (4, 2, 1, 3, 4, 2) and (4, 2, 3, 9, 4, 6) are also “correct” according to the above deﬁnition! However, we guarantee that every chemical equation we give you will lead to a unique correct equation by adjusting their coeﬃcients. In other words, we guarantee that (i) every chemical equation can be balanced with positive coeﬃcients, and that (ii) all balanced equations of the original equation can be obtained by multiplying the coeﬃcients of a unique correct equation by a positive integer.</div><p class="pst">Input</p><div class="ptx" lang="en-US">The input is a sequence of chemical equations (without coeﬃcients) of the following syntax in the Backus-Naur Form:<br/> <br/>&amp;ltchemical_equation&amp;gt ::= &amp;ltmolecule_sequence&amp;gt "-&gt;" &amp;ltmolecule_sequence&amp;gt<br/>&amp;ltmolecule_sequence&amp;gt ::= &amp;ltmolecule&amp;gt | &amp;ltmolecule&amp;gt "+" &amp;ltmolecule_sequence&amp;gt<br/>&amp;ltmolecule&amp;gt ::= &amp;ltgroup&amp;gt | &amp;ltgroup&amp;gt &amp;ltmolecule&amp;gt<br/>&amp;ltgroup&amp;gt ::= &amp;ltunit_group&amp;gt | &amp;ltunit_group&amp;gt &amp;ltnumber&amp;gt<br/>&amp;ltunit_group&amp;gt ::= &amp;ltchemical_element&amp;gt | "(" &amp;ltmolecule&amp;gt ")"<br/>&amp;ltchemical_element&amp;gt ::= &amp;ltuppercase_letter&amp;gt | &amp;ltuppercase_letter&amp;gt &amp;ltlowercase_letter&amp;gt<br/>&amp;ltuppercase_letter&amp;gt ::= "A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" | "I" | "J" | "K" | "L" | "M" | "N" | "O" | "P" | "Q" | "R" | "S" | "T" | "U" | "V" | "W" | "X" | "Y" | "Z"<br/>&amp;ltlowercase_letter&amp;gt ::= "a" | "b" | "c" | "d" | "e" | "f" | "g" | "h" | "i" | "j" | "k" | "l" | "m" | "n" | "o" | "p" | "q" | "r" | "s" | "t" | "u" | "v" | "w" | "x" | "y" | "z"<br/>&amp;ltnumber&amp;gt ::= &amp;ltnon_zero_digit&amp;gt | &amp;ltnon_zero_digit&amp;gt &amp;ltdigit&amp;gt<br/>&amp;ltnon_zero_digit&amp;gt ::= "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"<br/>&amp;ltdigit&gt; ::= "0" | &amp;ltnon_zero_digit&amp;gt<br/> <br/>Each chemical equation is followed by a period and a newline. No other characters such as spaces do not appear in the input. For instance, the equation<br/> <br/>Ca(OH)<sub>2</sub> + CO<sub>2</sub> -&gt; CaCO<sub>3</sub> + H<sub>2</sub>O<br/> <br/>is represented as<br/> <br/>Ca(OH)2+CO2-&gt;CaCO3+H2O.<br/> <br/>Each chemical equation is no more than 80 characters long, and as the above syntax implies, the <number>’s are less than 100. Parentheses may be used but will not be nested (maybe a good news to some of you!). Each side of a chemical equation consists of no more than 10 top-level molecules. The coeﬃcients that make the equations correct will not exceed 40000. The chemical equations in the input have been chosen so that 32-bit integer arithmetic would suﬃce with appropriate precautions against possible arithmetic overﬂow. You are free to use 64-bit arithmetic, however.<br/> <br/>The end of the input is indicated by a line consisting of a single period.<br/> <br/>Note that our deﬁnition of &amp;ltchemical_element&amp;gt above allows chemical elements that do not exist or unknown as of now, and excludes known chemical elements with three-letter names (e.g., ununbium (Uub), with the atomic number 112).</number></div><p class="pst">Output</p><div class="ptx" lang="en-US">For each chemical equation, output a line containing the sequence of positive integer coeﬃcients that make the chemical equation correct. Numbers in a line must be separated by a single space. No extra characters should appear in the output.</div><p class="pst">Sample Input</p><pre class="sio">N2+H2-&gt;NH3.
Na+Cl2-&gt;NaCl.
Ca(OH)2+CO2-&gt;CaCO3+H2O.
CaCl2+AgNO3-&gt;Ca(NO3)2+AgCl.
C2H5OH+O2-&gt;CO2+H2O.
C4H10+O2-&gt;CO2+H2O.
A12B23+C34D45+ABCD-&gt;A6D7+B8C9.
A98B+B98C+C98-&gt;A98B99C99.
A2+B3+C5+D7+E11+F13-&gt;ABCDEF.
.</pre><p class="pst">Sample Output</p><pre class="sio">1 3 2
2 1 2
1 1 1 1
1 2 1 2
1 3 2 3
2 13 8 10
2 123 33042 5511 4136
1 1 1 1
15015 10010 6006 4290 2730 2310 30030</pre><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=Tokyo+2009">Tokyo 2009</a></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=3807">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=3807">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=3807">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
