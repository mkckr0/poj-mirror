<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>3964 -- Factorial Simplification</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D3964"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=3964&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">Factorial Simplification</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 10000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 308</td><td width="10px"></td><td><b>Accepted:</b> 96</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">Peter is working on a combinatorial problem. He has carried out quite lengthy derivations and got a resulting formula that is a ratio of two products of factorials like this:<br/><center><img align="absmiddle" alt="\frac{p_1!p_2!...p_n!}{q_1!q_2!...q_m!}" src="../formula?tex=%5Cfrac%7Bp_1%21p_2%21...p_n%21%7D%7Bq_1%21q_2%21...q_m%21%7D"/></center> <br/>This does not surprise Peter, since factorials appear quite often in various combinatorial formulae, because n! represents the number of transpositions of n elements — one of the basic combinatorial objects.<br/>However, Peter might have made a mistake in his derivations. He knows that the result should be an integer number and he needs to check this first. For an integer result Peter wants to simplify this formula to get a better feeling of its actual combinatorial significance. He wants to represent the same number as a product of factorials like this.<br/><center><img align="absmiddle" alt="r_1!^{s_1}r_2!^{s_2}...r_k!^{s_k}t" src="../formula?tex=r_1%21%5E%7Bs_1%7Dr_2%21%5E%7Bs_2%7D...r_k%21%5E%7Bs_k%7Dt"/></center> <br/>where all r<sub>i</sub> are distinct integer numbers greater than one in the descending order (r<sub>i</sub> &gt; r<sub>i+1</sub> &gt; 1), s<sub>i</sub> and t are positive integers. Among all the possible representations in this form, Peter is interested in one where r<sub>1</sub> is the largest possible number, among those in the one where s<sub>1</sub> is the largest possible number; among those in the one where r<sub>2</sub> is the largest possible number; among those in the one where s<sub>2</sub> is the largest possible number; etc, until the remaining t cannot be further represented in this form. Peter does not care about the actual value of t. He wants to know what is the factorial-product part of his result.</div><p class="pst">Input</p><div class="ptx" lang="en-US">The first line of the input file contains two integer numbers n and m (1 &lt;= n,m &lt;= 1000). The second line of the input file contains n integer numbers pi (1 &lt;= pi &lt;= 10 000) separated by spaces. The third line of the input file contains m integer numbers qi (1 &lt;= qi &lt;= 10 000) separated by spaces.</div><p class="pst">Output</p><div class="ptx" lang="en-US">On the first line of the output write a single integer number k. Write k = -1 if the ratio of the given factorial products is not an integer. Write k = 0 if the ratio is an integer but it cannot be represented in the desired form. Write k &gt; 0 followed by k lines if the ratio can be represented by a factorial product as described in the problem statement. On each of the following k lines write two integers r<sub>i</sub> and s<sub>i</sub> (for i = 1 ... k) separated by a space.</div><p class="pst">Sample Input</p><pre class="sio"></pre><table border="1" bordercolor="#000000" id="table1" style="border-collapse: collapse"><tr>
<td><b>#1</b></td><td>
1 2<br/>
6<br/>
4 4</td>
</tr>
<tr>
<td><b>#2</b></td><td>
1 2<br/>
6<br/>
3 4</td></tr>
<tr>
<td><b>#3</b></td><td>
4 2<br/>
9 2 2 2<br/>
3 4</td></tr>
</table><p class="pst">Sample Output</p><pre class="sio"></pre><table border="1" bordercolor="#000000" id="table1" style="border-collapse: collapse"><tr>
<td><b>#1</b></td><td>
-1</td>
</tr>
<tr>
<td><b>#2</b></td><td>
0</td></tr>
<tr>
<td><b>#3</b></td><td>
2<br/>
7 1<br/>
2 2</td></tr>
</table><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=Northeastern+Europe+2010">Northeastern Europe 2010</a></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=3964">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=3964">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=3964">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
