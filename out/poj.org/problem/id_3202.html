<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>3202 -- A Very Simple Compiler</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D3202"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=3202&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">A Very Simple Compiler</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 5000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 131072K</td></tr><tr><td><b>Total Submissions:</b> 85</td><td width="10px"></td><td><b>Accepted:</b> 3</td></tr><tr><td style="color:#0ead00"><b>Case Time Limit:</b> 2000MS</td><td width="10px"></td><td style="font-weight:bold; color:red;">Special Judge</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US"><span lang="en-us"><p>A typical assignment for computer science students is to build a compiler that compiles a simple language for a RISC architecture, which, when it goes to extremes, could become: evaluating an expression on an ultimate RISC architecture – a One Instruction Set Computer (OISC).</p><p><b>Target Architecture</b></p><p>The target architecture has a memory consisting of 65,536 16-bit words and a 16-bit instruction pointer IP. As suggested by its name, it has only one instruction: subtract-and-branch-if-non-negative. In each instruction cycle, the processor reads three consecutive words <i>a</i>, <i>b</i> and <i>c</i> at the address stored in IP, then subtracts <i>a</i> from the word at address <i>b</i>. If the result is non-negative, IP is set to <i>c</i>, otherwise it is increased by three. (Here by “subtract” and “non-negative” we mean 16-bit signed integer arithmetic.) When IP is greater than or equal to 65,534, the processor halts.</p><p>A program is executed as follows:</p><ol><li>The program is loaded into memory starting from address 0.</li><li>A word-sized input parameter is placed at address 0, overwriting the program’s first word.</li><li>IP is set to 0.</li><li>The processor starts execution until it halts.</li><li>The word at address 0 is considered as the output.</li></ol><p><b>Source Language</b></p><p>The source language is an arithmetic expression consisting of only ‘<code>(</code>’, ‘<code>)</code>’, ‘<code>+</code>’, ‘<code>*</code>’, ‘<code>x</code>’ and floating-point constants. ‘<code>x</code>’ represents the input. The expression is supposed to be evaluated in exactly the same manner as its literally specified semantics, i.e., subexpressions in parentheses take highest precedence, followed by multiplication then addition. All constants, intermediate results and the input ‘<code>x</code>’ are rounded to 16-bit half-precision floating point numbers by the round-to-even method. </p><p>Given an expression, your task is to compile it into an OISC program.</p><hr align="left" size="1" width="400"/><p><b>A quick reference for half-precision floating point</b> </p><p><i>Memory format</i></p><blockquote><p>Half precision memory format has a sign bit, 5 bits of exponent and 10 bits of mantissa:</p><table border="1" bordercolor="#000000" cellpadding="2" cellspacing="0" style="border-collapse: collapse"><tr><td rowspan="2" valign="top" width="25"><p align="center">bit</p></td><td width="30">15</td><td width="60">14~10</td><td width="60">9~0</td></tr><tr><td width="30">sign</td><td width="60">exponent</td><td width="60">mantissa</td></tr></table><p>The mathematical value of a half-precision floating point number is (−1)<sup>sign</sup> × <span style="text-decoration: overline">1.mantissa</span> × 2<sup>exponent − 15</sup>. Below are several examples.</p><table border="1" bordercolor="#000000" cellpadding="2" cellspacing="0" style="border-collapse: collapse"><tr><td>Encoding</td><td>Value</td></tr><tr><td>0 01111 000000000</td><td>1</td></tr><tr><td>0 01111 100000000</td><td>1.5</td></tr><tr><td>1 01110 100000000</td><td>−0.75</td></tr></table><p>Among all possible exponents, 0 and 31 are reserved for representation of special values and not involved in this problem.</p></blockquote><p><i>Rounding convention</i></p><blockquote><p>Rounding is done by the round-to-even method, i.e., an unrepresentable value is rounded to the nearest number unless two possible outcomes are equally near, in which case the one with an even least significant bit is chosen. Below are several examples.</p><table border="1" bordercolor="#000000" cellpadding="2" cellspacing="0" style="border-collapse: collapse"><tr><td>Decimal</td><td>Binary</td><td>Rounded in half precision</td><td>Rounded in binary</td></tr><tr><td>0.499755859375</td><td>0.0111111111111</td><td>0 01110 0000000000</td><td>0.1</td></tr><tr><td>2.0009765625</td><td>10.0000000001</td><td>0 10000 0000000000</td><td>10</td></tr><tr><td>0.6</td><td>0.10011001…</td><td>0 01110 0011001101</td><td>0.10011001101</td></tr></table></blockquote><p>Below are two routines written in C for simplified conversions between half-precision and single-precision floating point numbers.</p><p><code>typedef unsigned short half;<br/><br/>float half_to_float(half h)<br/>{<br/>    unsigned int f;<br/>    if ((h &amp; 0x7ffff) == 0) return 0;<br/>    f = ((h &amp; 0x8000) &lt;&lt; 16) /* sign                  */<br/>      + ((h &amp; 0x7fff) &lt;&lt; 13) /* exponent and mantissa */<br/>      + ((127 - 15) &lt;&lt; 23);  /* adjust exponent       */<br/>    return *(float*)&amp;f;<br/>}<br/><br/>half float_to_half(float f)<br/>{<br/>    unsigned int u = *(unsigned int*)&amp;f;<br/>    int e = ((u &gt;&gt; 23) &amp; 0xff) - 127 + 15;                /* exponent                 */<br/>    int m = ((u &gt;&gt; 13) &amp; 0x3ff) + ((u &gt;&gt; 12) &amp; 1);        /* mantissa rounded half-up */<br/>    if ((u &amp; 0x1fff) == 0x1000) m &amp;= 0x7fe;               /* round to even            */<br/>    if (m == 0x400) { m = 0; e++; }                       /* carry             */<br/>    if (e &lt;= 0) { return (u &gt;&gt; 16) &amp; 0x8000; }            /* underflow or zero        */<br/>    if (e &gt; 30) { return 0x7bff + ((u &gt;&gt; 16) &amp; 0x8000); } /* overflow                 */<br/>    return ((u &gt;&gt; 16) &amp; 0x8000) + (e &lt;&lt; 10) + m;<br/>}</code></p></span></div><p class="pst">Input</p><div class="ptx" lang="en-US"><p>The input is presented as an expression on a single line. The expression can contain up to 8 arithmetic operators.</p></div><p class="pst">Output</p><div class="ptx" lang="en-US"><p>The output should be a line of at most 65,536 space-separated integers, each representing a word in the OISC program starting from address 0. Memory unoccupied when the program is loaded will be filled with 0.</p></div><p class="pst">Sample Input</p><pre class="sio">0.499755859375+0.125*(2.0009765625+2)</pre><p class="pst">Sample Output</p><pre class="sio">0 0 3 -15360 0 65535</pre><p class="pst">Hint</p><div class="ptx" lang="en-US"><p>Underflow, overflow and special values (zeroes, denormals, infinities and NaNs) will not occur in this problem.</p><p>Rounding to single precision before rounding to half precision is always safe in this problem.</p></div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=POJ+Monthly--2007.03.04">POJ Monthly--2007.03.04</a>, Hou, Qiming</div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=3202">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=3202">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=3202">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
