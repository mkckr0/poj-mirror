<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>1773 -- Outernet</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D1773"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=1773&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">Outernet</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 1000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 30000K</td></tr><tr><td><b>Total Submissions:</b> 401</td><td width="10px"></td><td><b>Accepted:</b> 118</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">A company named Outdaters is running a small computer wire line network, called Outernet. Not like Internet, Outernet is not base on the TCP/IP protocol. Due to lacking of money, not all the computers in Outernet can communicate with each other directly.<br/>Outdaters have already found the solution. They created a protocol to make all computers in the network become application proxies. An application proxy can receive data from a connected computer and send them out to another connected computer. Therefore, by using this protocol in Outernet, if a computer wants to send something to a computer not linked directly, it has to send them to a connected computer/application proxy and ask it to help sending them to the destination or another connected computer/application proxy.<br/><center><img src="../images/1773_1.jpg"/></center> <br/>The protocol is described as<br/>A. Port<br/>Application proxies use port to indicate each connected computer. Port number is an integer number from 0 to 32,767. To an application proxy, 0 means the application proxy itself, each other port number represents a unique computer connected to the application proxy.<br/> <br/>B. Commands<br/>The application proxy accepts only 3 commands, case sensitive: TO, DATA, QUIT.<br/>To each incoming command, application proxy will response with 3-digit result code in a line to the incoming port after handled this command.<br/>Format:<br/>xxx&lt; LF &gt; xxx -- the 3-digit result code<br/>Result codes:<br/>100: OK. No error/Data routed to destination<br/>101: OK. Data routed to application. (Destination computer is application proxy itself.)<br/>200: Session ends (Response to QUIT command)<br/>300: Unknown command<br/>301: Unknown destination<br/>302: No session began<br/>303: Looping not allowed (when incoming port = outgoing port)<br/> <br/>Details for each command:<br/>1. TO:&lt; destination computer name &gt;&lt; LF &gt;<br/>Tell the application proxy, the following data need to be sent to &lt; destination computer name &gt; ,and cancel the last "TO" command's effect (send a "QUIT" command to the original destination computer). If TO command fails (result code is neither 100 nor 101), the state of the application proxy will not be changed.<br/>Possible result codes are:<br/>100: The destination computer is found in routing table, and not the application proxy itself.<br/>101: The destination computer is found in routing table, and IS the application proxy itself.<br/>301: The destination computer is not found in routing table<br/>303: The destination computer is found in routing table, but incoming port = outgoing port<br/> <br/>2. DATA&lt; LF &gt;&lt; the data &gt;&lt; a dot "." &gt; &lt; LF &gt;<br/>Send &lt; the data &gt; to destination computer. &lt; the data &gt; will be regarded as a data stream, and sent to the destination without any alteration if the destination computer is not the application proxy itself. The backslash ("\") is the meta character, "\." means a simple dot ".", instead of then end indicator, and "\\" means "\".<br/>Possible result codes are:<br/>100: The destination computer is found in routing table, and not the application proxy itself. The data is routed to the corresponding outgoing port.<br/>101: The destination computer is found in routing table, and IS the application proxy itself.The data is routed to the application running on this application proxy.<br/>302: No session began, this command is ignored.<br/> <br/>3. QUIT&lt; LF &gt;<br/>End this communication session.<br/>Possible result codes are:<br/>200: Session ends(Response to QUIT command)<br/>302: No session began, this command is ignored.<br/> <br/>C. Session<br/>When a computer (the requester) sends a "TO" command to an application proxy, a communication session begins; when a "QUIT" command is sent to the application proxy, the session ends. In a session, the requester can send multiple "TO" and "DATA" commands to an application proxy to send out multiple messages.<br/><b> An application proxy is able to handle sessions simultaneously from different ports.</b> <br/> <br/>D. Routing table<br/>Each application proxy holds a routing table. It uses this table to find which port should be used the destination computer name. Each line in the routing table contains 2 fields, the first is the destination computer name, and the second is the outgoing port number. It means, the data to be sent to a computer with the destination computer name, will be sent out via the port with the outgoing port number. Port number 0 means, the data should be routed to the application running on this application proxy; that destination computer name is actually the application proxy's name.<br/> <br/>E. Routing<br/>Application proxies use the same "TO", "DATA", "QUIT" commands to route the incoming data if the routing is possible.<br/>After searching on the routing table, if the outgoing port found, application proxies must create a complete session on the outgoing port for each valid incoming "TO" command: one "TO" command at the beginning, zero or more DATA commands to route the data, one "QUIT" command in the end if the incoming session ends or another incoming "TO" command is received.<br/> <br/><b>Port 0 is handled as same as other outgoing ports except that no actually outgoing command is sent</b> , i.e. all the commands' result code will be sent to the incoming port, but no commands will be sent to any outgoing port.<br/>Now, Outdaters hires you to write the engine to implement the protocol for the application proxy.</div><p class="pst">Input</p><div class="ptx" lang="en-US">The input consists of a sequence of testcases. Each begins with a routing table of an application proxy and then the incoming requests of the application proxy.<br/>A routing table includes, in order, a line with an integer M (1 &lt;= M &lt;= 32,768), the number of lines in the routing table; M lines, each of which has a routing line. Each routing line contains a unique destination computer name (1 to 15 alphanumeric characters in the routing table), and then the outgoing port number (0 to 32,767 integer), separated by a space, and the computer names are case sensitive.<br/>The incoming requests of the application proxy include several request sessions from the connected computers. A line starts with a number sign "#" and then an integer P (-1, 1 to 32,767),means the following input is from port P, P &lt; 0 means the testcase finishes. The commands in request sessions will not be broken by the "#" lines. To simplify the input handling, data commands in our input file will just contain "0"-"9", "a"-"z", "A"-"Z", "@", "#", "_", "+", "-", "*","/" , "\", "?", ",", "." and &lt; LF &gt;.<br/>The input is terminated by a single zero</div><p class="pst">Output</p><div class="ptx" lang="en-US">For each testcase, print all the outputs of the ports sending out data, in the order of the corresponding input. For each port's output, a line starts with a number sign "#" and then an integer P (-1, 1 to 32,767), means the following commands are output in port P, P=-1 means the output of the current testcase finishes. Following the "#" line is the commands output in this port till another "#" line. A "#" line is needed only when the port number need to be changed.<br/>#&lt; port number &gt;&lt; LF &gt;<br/>the commands output in this port<br/>#&lt; another port number &gt;&lt; LF &gt;<br/>the commands output in this port<br/>...<br/>#-1&lt; LF &gt;</div><p class="pst">Sample Input</p><pre class="sio">5
RED 0
YELLOW 1
GREEN 2
BLUE 3
WHITE 3
#1
TO:GREEN
DATA
HELLO
.
#4
TO:WHITE
#1
Quit
QUIT
#2
TO:GREEN
DATA
A JOKE to myself
.
QUIT
#3
TO:ORANGE
QUIT
#4
QUIT
#-1
0</pre><p class="pst">Sample Output</p><pre class="sio">#2
TO:GREEN
#1
100
#2
DATA
HELLO
.
#1
100
#3
TO:WHITE
#4
100
#1
300
#2
QUIT
#1
200
#2
303
302
302
#3
301
302
QUIT
#4
200</pre><p class="pst">Hint</p><div class="ptx" lang="en-US">&lt; LF &gt; means 0xa.</div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=Asia+Guangzhou+2003">Asia Guangzhou 2003</a></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=1773">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=1773">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=1773">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
