<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>3523 -- The Morning after Halloween</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D3523"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=3523&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">The Morning after Halloween</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 8000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 3497</td><td width="10px"></td><td><b>Accepted:</b> 806</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US"><p>You are working for an amusement park as an operator of an <i>obakeyashiki</i>, or a haunted house, in which guests walk through narrow and dark corridors. The house is proud of their lively ghosts, which are actually robots remotely controlled by the operator, hiding here and there in the corridors. One morning, you found that the ghosts are not in the positions where they are supposed to be. Ah, yesterday was Halloween. Believe or not, paranormal spirits have moved them around the corridors in the night. You have to move them into their right positions before guests come. Your manager is eager to know how long it takes to restore the ghosts.</p><p>In this problem, you are asked to write a program that, given a floor map of a house, finds the smallest number of steps to move all ghosts to the positions where they are supposed to be.</p><p>A floor consists of a matrix of square cells. A cell is either a wall cell where ghosts cannot move into or a corridor cell where they can.</p><p>At each step, you can move any number of ghosts simultaneously. Every ghost can either stay in the current cell, or move to one of the corridor cells in its 4-neighborhood (i.e. immediately left, right, up or down), if the ghosts satisfy the following conditions:</p><ol><li><p>No more than one ghost occupies one position at the end of the step.</p></li><li><p>No pair of ghosts exchange their positions one another in the step.</p></li></ol><p>For example, suppose ghosts are located as shown in the following (partial) map, where a sharp sign (‘<tt>#</tt>’) represents a wall cell and ‘<tt>a</tt>’, ‘<tt>b</tt>’, and ‘<tt>c</tt>’ ghosts.</p><div align="center"><pre>####<br/> ab#<br/>#c##<br/>####</pre></div><p>The following four maps show the only possible positions of the ghosts after one step.</p><table align="center" border="0"><tr><td width="16%"><pre>####<br/> ab#<br/>#c##<br/>####</pre></td><td width="12%"></td><td width="16%"><pre>####<br/>a b#<br/>#c##<br/>####</pre></td><td width="12%"></td><td width="16%"><pre>####<br/>acb#<br/># ##<br/>####</pre></td><td width="12%"></td><td width="16%"><pre>####<br/>ab #<br/>#c##<br/>####</pre></td></tr></table></div><p class="pst">Input</p><div class="ptx" lang="en-US"><p>The input consists of at most 10 datasets, each of which represents a floor map of a house. The format of a dataset is as follows.</p><div style="padding-left: 2em;"><table border="0"><tr><td><i>w</i></td><td><i>h</i></td><td><i>n</i></td><td></td></tr><tr><td><i>c</i><sub>11</sub></td><td><i>c</i><sub>12</sub></td><td>⋯</td><td><i>c</i><sub>1<i>w</i></sub></td></tr><tr><td><i>c</i><sub>21</sub></td><td><i>c</i><sub>22</sub></td><td>⋯</td><td><i>c</i><sub>2<i>w</i></sub></td></tr><tr><td align="center">⋮</td><td align="center">⋮</td><td>⋱</td><td align="center">⋮</td></tr><tr><td><i>c</i><sub><i>h</i>1</sub></td><td><i>c</i><sub><i>h</i>2</sub></td><td>⋯</td><td><i>c<sub>hw</sub></i></td></tr></table></div><p><i>w</i>, <i>h</i> and <i>n</i> in the first line are integers, separated by a space. <i>w</i> and <i>h</i> are the floor width and height of the house, respectively. <i>n</i> is the number of ghosts. They satisfy the following constraints.</p><p align="center">4 ≤ <i>w</i> ≤ 16, 4 ≤ <i>h</i> ≤ 16, 1 ≤ <i>n</i> ≤ 3</p><p>Subsequent <i>h</i> lines of <i>w</i> characters are the floor map. Each of <i>c<sub>ij</sub></i> is either:</p><ul><li><p>a ‘<tt>#</tt>’ representing a wall cell,</p></li><li><p>a lowercase letter representing a corridor cell which is the initial position of a ghost,</p></li><li><p>an uppercase letter representing a corridor cell which is the position where the ghost corresponding to its lowercase letter is supposed to be, or</p></li><li><p>a space representing a corridor cell that is none of the above.</p></li></ul><p>In each map, each of the first <i>n</i> letters from <tt>a</tt> and the first <i>n</i> letters from <tt>A</tt> appears once and only once. Outermost cells of a map are walls; i.e. all characters of the first and last lines are sharps; and the first and last characters on each line are also sharps. All corridor cells in a map are connected; i.e. given a corridor cell, you can reach any other corridor cell by following corridor cells in the 4-neighborhoods. Similarly, all wall cells are connected. Any 2 × 2 area on any map has at least one sharp. You can assume that every map has a sequence of moves of ghosts that restores all ghosts to the positions where they are supposed to be.</p><p>The last dataset is followed by a line containing three zeros separated by a space.</p></div><p class="pst">Output</p><div class="ptx" lang="en-US"><p>For each dataset in the input, one line containing the smallest number of steps to restore ghosts into the positions where they are supposed to be should be output. An output line should not contain extra characters such as spaces.</p></div><p class="pst">Sample Input</p><pre class="sio">5 5 2
#####
#A#B#
#   #
#b#a#
#####
16 4 3
################
## ########## ##
#    ABCcba    #
################
16 16 3
################
### ##    #   ##
##  #  ##   # c#
#  ## ########b#
# ##  # #   #  #
#  # ##   # # ##
##  a#  # # #  #
### ## #### ## #
##   #   #  #  #
#  ##### # ## ##
####   #B# #   #
##  C#   #   ###
#  # # ####### #
# ######  A##  #
#        #    ##
################
0 0 0</pre><p class="pst">Sample Output</p><pre class="sio">7
36
77</pre><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=Japan+2007">Japan 2007</a></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=3523">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=3523">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=3523">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
