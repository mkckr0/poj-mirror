<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>1984 -- Navigation Nightmare</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D1984"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=1984&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">Navigation Nightmare</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 2000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 30000K</td></tr><tr><td><b>Total Submissions:</b> 10833</td><td width="10px"></td><td><b>Accepted:</b> 3930</td></tr><tr><td align="center" colspan="3" style="color:#0ead00"><b>Case Time Limit:</b> 1000MS</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">Farmer John's pastoral neighborhood has N farms (2 &lt;= N &lt;= 40,000), usually numbered/labeled 1..N.  A series of M (1 &lt;= M &lt; 40,000) vertical and horizontal roads each of varying lengths (1 &lt;= length &lt;= 1000) connect the farms.  A map of these farms might look something like the illustration below in which farms are labeled F1..F7 for clarity and lengths between connected farms are shown as (n):<br/><pre>           F1 --- (13) ---- F6 --- (9) ----- F3<br/>            |                                 |<br/>           (3)                                |<br/>            |                                (7)<br/>           F4 --- (20) -------- F2            |<br/>            |                                 |<br/>           (2)                               F5<br/>            | <br/>           F7 </pre> <br/>Being an ASCII diagram, it is not precisely to scale, of course.<br/> <br/>Each farm can connect directly to at most four other farms via roads that lead exactly north, south, east, and/or west.  Moreover, farms are only located at the endpoints of roads, and some farm can be found at every endpoint of every road.  No two roads cross, and precisely one path <br/>(sequence of roads) links every pair of farms.<br/> <br/>FJ lost his paper copy of the farm map and he wants to reconstruct it from backup information on his computer.  This data contains lines like the following, one for every road:<br/> <br/>   There is a road of length 10 running north from Farm #23 to Farm #17<br/>   There is a road of length 7 running east from Farm #1 to Farm #17<br/>   ...<br/> <br/>As FJ is retrieving this data, he is occasionally interrupted by questions such as the following that he receives from his navigationally-challenged neighbor, farmer Bob:<br/> <br/>    What is the Manhattan distance between farms #1 and #23?<br/> <br/>FJ answers Bob, when he can (sometimes he doesn't yet have enough data yet).  In the example above, the answer would be 17, since Bob wants to know the "Manhattan" distance between the pair of farms.<br/>The Manhattan distance between two points (x1,y1) and (x2,y2) is just |x1-x2| + |y1-y2| (which is the distance a taxicab in a large city must travel over city streets in a perfect grid to connect two x,y points).<br/> <br/>When Bob asks about a particular pair of farms, FJ might not yet have enough information to deduce the distance between them; in this case, FJ apologizes profusely and replies with "-1".<br/></div><p class="pst">Input</p><div class="ptx" lang="en-US"><pre>* Line 1: Two space-separated integers: N and M<br/><br/>* Lines 2..M+1: Each line contains four space-separated entities, F1,<br/>        F2, L, and D that describe a road. F1 and F2 are numbers of<br/>        two farms connected by a road, L is its length, and D is a<br/>        character that is either 'N', 'E', 'S', or 'W' giving the<br/>        direction of the road from F1 to F2.<br/><br/>* Line M+2: A single integer, K (1 &lt;= K &lt;= 10,000), the number of FB's<br/>        queries<br/><br/>* Lines M+3..M+K+2: Each line corresponds to a query from Farmer Bob<br/>        and contains three space-separated integers: F1, F2, and I. F1<br/>        and F2 are numbers of the two farms in the query and I is the<br/>        index (1 &lt;= I &lt;= M) in the data after which Bob asks the<br/>        query. Data index 1 is on line 2 of the input data, and so on.</pre></div><p class="pst">Output</p><div class="ptx" lang="en-US"><pre>* Lines 1..K: One integer per line, the response to each of Bob's<br/>        queries.  Each line should contain either a distance<br/>        measurement or -1, if it is impossible to determine the<br/>        appropriate distance.</pre></div><p class="pst">Sample Input</p><pre class="sio">7 6
1 6 13 E
6 3 9 E
3 5 7 S
4 1 3 N
2 4 20 W
4 7 2 S
3
1 6 1
1 4 3
2 6 6
</pre><p class="pst">Sample Output</p><pre class="sio">13
-1
10
</pre><p class="pst">Hint</p><div class="ptx" lang="en-US">At time 1, FJ knows the distance between 1 and 6 is 13.<br/>At time 3, the distance between 1 and 4 is still unknown.<br/>At the end, location 6 is 3 units west and 7 north of 2, so the distance is 10.<br/></div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=USACO+2004+February">USACO 2004 February</a></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=1984">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=1984">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=1984">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
