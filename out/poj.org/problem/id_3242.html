<html><head><meta content="no-cache" http-equiv="Pragma"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="en-US" http-equiv="Content-Language"/><title>3242 -- 3-dimensional Musical Water-fence</title><link href="../poj.css" rel="stylesheet" type="text/css"/><link href="../poj.ico" rel="shortcut icon"/><link href="../poj.gif" rel="icon" type="image/gif"/><script language="javascript" src="../poj.js"></script></head><body alink="blue" lang="en-US" leftmargin="5" link="blue" onkeydown="KeyDown(event)" vlink="blue"><a name="top"></a><table border="1" bordercolor="#ffffff" style="BORDER-COLLAPSE: collapse" width="100%"><tbody><tr><td align="CENTER" colspan="5"><table cellpadding="0" class="h1"><tr><td align="left" width="25%"><img border="0" height="100" src="../images/logo1.jpg"/></td><td bgcolor="#EAEFFD" colspan="3"><table class="h2"><tr><td><img border="0" height="90" src="../images/logo0.gif" width="450"/></td><td width="95"><img border="0" height="95" src="../images/logo3.gif" width="95"/></td></tr></table></td></tr></table></td></tr><tr align="CENTER" bgcolor="#6589d1" valign="top"><th class="h">Online Judge</th><th class="h">Problem Set</th><th class="h">Authors</th><th class="h">Online Contests</th><th class="h">User</th></tr><tr align="CENTER" bgcolor="#f1f1fd" valign="top"><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><a href="http://poj.org/bbs">Web Board</a><br/><a href="../index.html">Home Page</a><br/><a href="../page/id_1000.html" target="_blank">F.A.Qs</a><br/><a href="http://poj.org/chart">Statistical Charts</a></td><td class="h" onmouseout="scbg(this, 0)" onmouseover="scbg(this, 1)"><form onsubmit="event.preventDefault(); let pid = (new FormData(event.target)).get('pid'); window.location=`../problem/id_${pid}.html`"><a href="../problemlist.html">Problems</a><br/><a href="http://poj.org/submit">Submit Problem</a><br/><a href="http://poj.org/status">Online Status</a><br/><font color="blue">Prob.ID:</font><input name="pid" size="6" type="text"/><input name="pb1" type="Submit" value="Go"/></form></td><td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="searchuser" method="GET"><a href="http://poj.org/register">Register</a><br/><a href="http://poj.org/modifyuser">Update your info</a><br/><a href="http://poj.org/userlist">Authors ranklist</a><br/><input name="key" size="10" type="text"/><input name="B1" type="Submit" value="Search"/></form></td>
<td class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><font color="#1a5cc8">Current Contest</font><br/><a href="http://poj.org/pastcontests">Past Contests</a><br/><a href="http://poj.org/contests">Scheduled Contests</a><br/><a href="http://poj.org/challenge.html" target="_blank"><font color="red">Award Contest</font></a></td><td align="left" class="h" onmouseout="scbg(this,0)" onmouseover="scbg(this,1)"><form action="login" method="POST"><table><tr><td>User ID:</td><td><input name="user_id1" size="10" style="font-family:monospace" type="text"/></td></tr><tr><td>Password:</td><td><input name="password1" size="10" style="font-family:monospace" type="password"/></td></tr></table><input name="B1" type="Submit" value="login"/>  <a href="http://poj.org/register" target="_parent">Register</a><input name="url" type="hidden" value="%2Fproblem%3Fid%3D3242"/></form></td></tr></tbody></table><table background="../images/table_back.jpg" border="0" width="100%"><tr><td>
<div style="position: absolute; right: 10px;">Language:<select onchange="window.location.href='problem?id=3242&amp;lang='+this.value+'&amp;change=true'" size="1"><option selected="" value="default">Default</option></select></div><div class="ptt" lang="en-US">3-dimensional Musical Water-fence</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 8000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 187</td><td width="10px"></td><td><b>Accepted:</b> 51</td></tr><tr><td align="center" colspan="3" style="color:#0ead00"><b>Case Time Limit:</b> 4000MS</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US"><p>Once Farmer John was washing his dirty clothes. Staring at lots of buckets, he was inspired suddenly. He said, "I can make a 3-dimensional musical water-fence (abbr. 3dmwf) like this."</p><p>After ages Farmer John shaped a piece of wood into a perfect 3dmwf. As figure A illustrates, the 3dmwf is an array of n rows and m columns of squares. And each square in the <i>i</i>th row and <i>j</i>th column is entirely occupied by a block, b<sub>ij</sub> of height h<sub>ij</sub>. And there is a tap over each block which can pour water.</p><blockquote><div align="center"><img src="../images/3242_1.gif"/> <div>Figure A: A 3-dimensional musical water-fence<p>heights of the blocks are</p><table border="1" id="table1" width="34%"><tr><td align="center">5</td><td align="center">12</td><td align="center">11</td><td align="center">8</td></tr><tr><td align="center">15</td><td align="center">2</td><td align="center">4</td><td align="center">14</td></tr><tr><td align="center">16</td><td align="center">1</td><td align="center">3</td><td align="center">7</td></tr><tr><td align="center">13</td><td align="center">10</td><td align="center">9</td><td align="center">6</td></tr></table></div><p>If Farmer John turns on a tap some water will be poured onto the block under that tap due to the gravity. As soon as the water crashes onto the block a dulcet sound will be made. And the tune of the sound is determined by the height of the block that makes the sound. Farmer John dislikes the same tune made by two different blocks. So no blocks has the same height. For simplicity we assume that the height of each block is between 1 and n × m.</p><p>We define pour(i,j,k) as the operation pouring k units of water onto the block b<sub>ij</sub>. It is apparent that after pouring water onto 3dmwf probably some water will remain in concave holes. </p><p>When we pour(i,j,k) one and only one of the following two cases occurs:</p><p>(1) There is no water on the b<sub>ij</sub> and there is some neighboring block whose horizontal line is lower than the b<sub>ij</sub>.</p><p>Let Sum be the number of those neighboring blocks. Then pour(i,j,k) is equivalent to pour(i',j',<sup>k</sup>⁄<sub>Sum</sub>) where b<sub>i'j'</sub> is one of those neighboring blocks. That means the water will flow to all the lower neighboring blocks equally. </p><p>For example, in the previous figure, </p>pour(4,1,27)&lt;=&gt;<br/>pour(4,0,9), pour(5,1,9), pour(4,2,9) &lt;=&gt;<br/>waste 18 units of water, pour(5,2,3) , pour(4,3,3), pour(3,2,3) &lt;=&gt;<br/>waste 21 units of water, pour(5,3,1), pour(4,4,1), pour(3,3,1), pour(3,2,3) &lt;=&gt;<br/>waste 22 units of water, pour(5,4,0.5), pour(4,5,0.5), pour(3,3,1), pour(3,2,3) &lt;=&gt;<br/>waste 23 units of water, pour(3,3,1), pour(3,2,3).<br/>Obviously the water of pour(3,3,1) and pour(3,2,3) will be trapped in the concave hole formed by b<sub>22</sub>,b<sub>23</sub>,b<sub>32</sub> and b<sub>33</sub>. So finally the volume of the waste water is 23 units.<p>(2) There is some water on the b<sub>ij</sub> or there is no neighboring block whose horizontal line is lower than b<sub>ij</sub>.<br/>The k units of water will be mixed together with the water already on the b<sub>ij</sub>. Then the horizontal line of those mixed the water will rise up until impossible because there is an exit that makes the water out of the concave hole.<br/>For example, in the previous figure, continuing analyzing the last example,<br/>(A)pour(3,2,3). After pouring 1 unit of water the horizontal lines of all blocks will become </p><div align="center">　<table border="1" id="table2" width="34%"><tr><td align="center">5</td><td align="center">12</td><td align="center">11</td><td align="center">8</td></tr><tr><td align="center">15</td><td align="center">2</td><td align="center">4</td><td align="center">14</td></tr><tr><td align="center">16</td><td align="center">2</td><td align="center">3</td><td align="center">7</td></tr><tr><td align="center">13</td><td align="center">10</td><td align="center">9</td><td align="center">6</td></tr></table></div><p>And then after pouring 2 units of water the chart above will be become</p><div align="center"><table border="1" id="table3" width="34%"><tr><td align="center">5</td><td align="center">12</td><td align="center">11</td><td align="center">8</td></tr><tr><td align="center">15</td><td align="center">3</td><td align="center">4</td><td align="center">14</td></tr><tr><td align="center">16</td><td align="center">3</td><td align="center">3</td><td align="center">7</td></tr><tr><td align="center">13</td><td align="center">10</td><td align="center">9</td><td align="center">6</td></tr></table></div><p>(B)pour(3,3,1). After pouring 1 unit of water the chart above will become</p><div align="center"><table border="1" id="table4" width="34%"><tr><td align="center">5</td><td align="center">12</td><td align="center">11</td><td align="center">8</td></tr><tr><td align="center">15</td><td align="center">3<sup>1</sup>⁄<sub>3</sub></td><td align="center">4</td><td align="center">14</td></tr><tr><td align="center">16</td><td align="center">3<sup>1</sup>⁄<sub>3</sub></td><td align="center">3<sup>1</sup>⁄<sub>3</sub></td><td align="center">7</td></tr><tr><td align="center">13</td><td align="center">10</td><td align="center">9</td><td align="center">6</td></tr></table></div><p>(C)If we go on pouring a lot of water onto the concave hole, the chart above will become</p><div align="center"><table border="1" id="table5" width="34%"><tr><td align="center">5</td><td align="center">12</td><td align="center">11</td><td align="center">8</td></tr><tr><td align="center">15</td><td align="center">7</td><td align="center">7</td><td align="center">14</td></tr><tr><td align="center">16</td><td align="center">7</td><td align="center">7</td><td align="center">7</td></tr><tr><td align="center">13</td><td align="center">10</td><td align="center">9</td><td align="center">6</td></tr></table></div><p>The redundant water will flow away through the b<sub>34</sub>.</p><p>On a sunny day, after farming on his vast farm, Farmer John was exhausted. He wanted to listen to some dulcet music. So he composed a long music score for the 3dmwf. The music score is a list of pour(i,j,k) arranged in specific order. And now he invited his friends, Wang Dong, Guo Huayang, Chen Danqi, He Yijun to help him operate 3dmwf.</p><p>You know, Farmer John is an abstemious farmer. He doesn't want to waste too much water for playing music on 3dmwf. Could you tell him the volume of the total waste water? </p></div><p class="pst">Input</p><div class="ptx" lang="en-US">The input begins with two numbers, n and m, indicating the length of the row and the column respectively.<br/>The next n lines each contain m integers indicating the height of wood blocks.<br/>The next line contains a single integer, t, the size of the music score.<br/>The next t lines each contain three integers, i,j, and k, indicating pour(i,j,k). The order of pour(i,j,k) in the input is the same as that in the music score.<br/></div><p class="pst">Output</p><div class="ptx" lang="en-US">Print the volume of total waste water with 2 digits after the decimal point.</div><p class="pst">Sample Input</p><pre class="sio"><b>Sample Input 1</b>
4 4
5 12 11 8
15 2 4 14
16 1 3 7
13 10 9 6
1
4 1 27

<b>Sample Input 2</b>
4 4
5 12 11 8
15 2 4 14
16 1 3 7
13 10 9 6
2
4 1 27
2 2 100

</pre><p class="pst">Sample Output</p><pre class="sio"><b>Sample Output 1</b>
23.00

<b>Sample Output 2</b>
109.00</pre><p class="pst">Hint</p><div class="ptx" lang="en-US">1≤n≤1000<br/>1≤m≤1000<br/>0≤t≤1000000<br/>0≤k≤1000000<br/></div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="http://poj.org/searchproblem?field=source&amp;key=POJ+Monthly--2007.07.08">POJ Monthly--2007.07.08</a>, Chen, Qifeng</div></blockquote></div></td></tr></table>
<font color="#333399" size="3"><p align="center">
[<a href="http://poj.org/submit?problem_id=3242">Submit</a>]  
 [<a href="javascript:history.go(-1)">Go Back</a>]   [<a href="http://poj.org/problemstatus?problem_id=3242">Status</a>]   
[<a href="http://poj.org/bbs?problem_id=3242">Discuss</a>]
</p></font>
<p><img border="0" height="30" src="../images/home.gif" width="40"/><font size="3"><a href="../index.html">Home Page</a> </font>  <img border="0" height="30" src="../images/goback.gif" width="40"/><font size="3"><a href="javascript:history.go(-1)">Go Back</a>  <img border="0" height="30" src="../images/top.gif" width="40"/><a href="http://poj.org#top">To top</a></font><br/></p><hr/><p align="center" style="font-family:Arial, Helvetica, sans-serif">All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br/>Any problem, Please <a href="mailto:webmaster@poj.org">Contact Administrator</a></p></body></html>
